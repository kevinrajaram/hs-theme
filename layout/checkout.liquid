<!doctype html>
<html lang="{{ locale }}" dir="{{ direction }}" class="{{ checkout_html_classes }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, user-scalable=0"
    >
    <meta name="referrer" content="origin">

    <title>{{ page_title }}</title>

    {{ content_for_header }}

    {{ checkout_stylesheets }}
    {{ checkout_scripts }}

    <style>
      .hs-govx{
        color: #333333;
        text-decoration: underline;
        margin-top: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
        padding-right: 16px;
      }

      .hs-govx img{
        flex-shrink: 0;
        width: 50px;
        height: 50px;
        object-fit: contain;
      }

      .hs-govx:hover{
        color: #333333;
        text-decoration: none;
      }
    </style>

    <script type="application/javascript" async src="https://sdk.postscript.io/integrations/sdk-min.js"></script>
    <script defer src="https://attribution.decibelads.com/tag/6303a6d96cba"></script>
    {{- 'checkout.css' | asset_url | stylesheet_tag -}}

    <style>
      {%- assign brand_color = '%23994e0e' -%}
      body {background: #fff !important;}
      @media all and (min-width: 1000px) { .wrap {padding: 0 2%;} }
      .btn--luna {padding-top: 1.1em; padding-bottom: 1.1em; font-size: 15px; font-weight: 500; width: 100%; flex:1;}
      .luna-features li { position: relative; padding-left: 36px; font-style: normal;margin-top: 16px;font-weight: 500;font-size: 16px;line-height: 24px; }
      .luna-features li:before {background-repeat: no-repeat; background-position: center center; background-size: contain; content: "";height: 26px;width: 26px;position: absolute;left: 0;top: 0;}
      .luna-features li:nth-child(1):before {background-image: url("data:image/svg+xml,%3Csvg width='24' height='26' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M5.2 0c.72 0 1.302.583 1.302 1.302v3.9h-2.6v-3.9A1.3 1.3 0 0 1 5.2 0Zm13.002 0A1.3 1.3 0 0 1 19.5 1.302v3.9h-2.6v-3.9C16.9.582 17.482 0 18.2 0Z' fill='{{ brand_color }}'/%3E%3Cpath d='M20.799 2.6H2.6C1.17 2.6 0 3.77 0 5.202V23.4C0 24.83 1.17 26 2.6 26H20.8c1.43 0 2.6-1.17 2.6-2.6V5.201c0-1.43-1.17-2.6-2.6-2.6Zm-1.3 20.8H3.9a1.3 1.3 0 0 1-1.298-1.3V9.1h18.198V22.1a1.3 1.3 0 0 1-1.3 1.3Z' fill='{{ brand_color }}'/%3E%3C/svg%3E");}
      .luna-features li:nth-child(2):before {background-image: url("data:image/svg+xml,%3Csvg width='26' height='26' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M7.5 7.5H3.222V3.222' stroke='{{ brand_color }}' stroke-width='4' stroke-miterlimit='10' stroke-linecap='round' stroke-linejoin='round'/%3E%3Cpath d='M3.464 7.511A10.993 10.993 0 0 1 13 2c6.075 0 11 4.925 11 11s-4.925 11-11 11S2 19.075 2 13' stroke='{{ brand_color }}' stroke-width='4' stroke-miterlimit='10' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E");}
      .luna-features li:nth-child(3):before {background-image: url("data:image/svg+xml,%3Csvg width='29' height='20' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M22.5 14.687c.861 0 1.564.703 1.564 1.563s-.703 1.564-1.563 1.564-1.564-.704-1.564-1.564c0-.86.704-1.563 1.564-1.563Zm0-2.187a3.75 3.75 0 0 0-3.75 3.75A3.75 3.75 0 0 0 22.5 20a3.75 3.75 0 0 0 3.751-3.75 3.75 3.75 0 0 0-3.75-3.75Zm-15 2.187c.86 0 1.564.703 1.564 1.563S8.36 17.814 7.5 17.814c-.86 0-1.563-.704-1.563-1.564 0-.86.703-1.563 1.563-1.563Zm0-2.187a3.75 3.75 0 0 0-3.75 3.75A3.75 3.75 0 0 0 7.5 20a3.75 3.75 0 0 0 3.75-3.75A3.75 3.75 0 0 0 7.5 12.5Z' fill='{{ brand_color }}'/%3E%3Cpath d='m23.65 4.688 2.914 5.83v3.396a4.69 4.69 0 0 0-4.062-2.351c-1.054 0-2.03.349-2.812.94V4.688h3.96Zm.58-2.189h-6.727V16.25H20a2.502 2.502 0 0 1 5.002 0h2.499a1.25 1.25 0 0 0 1.251-1.249V10L25.348 3.19A1.248 1.248 0 0 0 24.23 2.5Z' fill='{{ brand_color }}'/%3E%3Cpath d='M18.752 9.999v6.251h1.25a2.502 2.502 0 0 1 5.001 0h2.498A1.25 1.25 0 0 0 28.753 15V10H18.752Z' fill='{{ brand_color }}'/%3E%3Cpath d='M0 1.25c0 .688.56 1.249 1.25 1.249H7.5a1.25 1.25 0 0 1 0 2.5h-5a1.25 1.25 0 1 0 0 2.501H5A1.25 1.25 0 1 1 5 10H2.5c-.69 0-1.25.56-1.25 1.252V15c0 .689.56 1.249 1.25 1.249H5a2.502 2.502 0 0 1 5.001 0h10V2.499A2.498 2.498 0 0 0 17.5 0H1.25C.56 0 0 .56 0 1.25Z' fill='{{ brand_color }}'/%3E%3C/svg%3E");}
      .luna-features li:nth-child(4):before { background-image: url("data:image/svg+xml,%3Csvg width='27' height='24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M9.598 24a2.4 2.4 0 1 0 0-4.8 2.4 2.4 0 0 0 0 4.8ZM21.598 24a2.4 2.4 0 1 0 0-4.8 2.4 2.4 0 0 0 0 4.8ZM19.825 13.2a2.4 2.4 0 0 0 2.098-1.235l4.324-7.783A1.202 1.202 0 0 0 25.198 2.4h-17.7L6.807.739A1.2 1.2 0 0 0 5.693 0l-2.09.01a1.2 1.2 0 0 0 .01 2.4L4.9 2.404l.69 1.656c.188.446.624.738 1.108.738l6.797.001-5.909 9.39a2.492 2.492 0 0 0 2.113 3.812h13.103a1.2 1.2 0 0 0 0-2.4H9.698l-.078-.14 1.413-2.26h8.792v-.002Z' fill='{{ brand_color }}'/%3E%3Cpath d='M9.144 7.198 7.68 9.526l-.048.072H0v-2.4h9.144ZM6.132 11.998l-1.524 2.4H0v-2.4h6.132Z' fill='{{ brand_color }}'/%3E%3C/svg%3E");}
      .luna-manage-subscription {background: #f0dfcb; border-radius: 8px;margin-top: 32px;padding: 20px;}
      @media all and (min-width: 1050px) {
        .btn--luna { max-width: 50%; margin-bottom: 7px; }
        .luna-features {display: flex; flex-wrap: wrap; margin: 0;}
        .luna-features li {flex: 1 50%; max-width: 50%; width: 50%; box-sizing: border-box;}
      }
    </style>
    <script>



        (function($) {
          let alreadyRan = false;
          $(document).on("page:load page:change", function() {
            if (Shopify.Checkout.step === "payment_method") {
              $(".section--subscription-agreement").prepend(`<div class="notice notice--error default-background" style="margin-bottom: 24px;" data-banner="true" role="alert" tabindex="-1" aria-atomic="true" aria-live="polite"><svg class="icon-svg icon-svg--size-24 notice__icon" aria-hidden="true" focusable="false"><use xlink:href="#error"></use></svg><div class="notice__content"><p class="notice__text">To continue with your purchase, agree to the subscription terms.</p></div></div>`);
            }
            if (Shopify.Checkout.page === "thank_you" || Shopify.Checkout.OrderStatus) {
              const orderStatusHeader = document.getElementsByClassName('os-header')[0];
              const orderStatusAccountBlock = `<div class="luna-manage-subscription">
              <a href="/account/login" class="btn btn--luna">Go To Your Account</a>
              <ul class="luna-features"><li>Review Upcoming Orders</li><li>Manage Your Subscriptions</li><li>Track Shipments</li><li>Faster Checkouts</li></ul></div>`;
              orderStatusHeader.insertAdjacentHTML('afterend', orderStatusAccountBlock);
            }

            $('.sms-marketing-fieldset').removeClass('hidden');
            $('.sms-marketing-fieldset .field--two-thirds').removeClass('field--active');

            // Custom Mother's Day info to display
            const lineItems = $('[data-order-summary-section="line-items"] .product');
            const lineItemIds = [];
            const mdItems = [5188833280131, 5188852875395, 5053974675587];
            const totalLinesTableBody = $('.total-line-table__tbody');
            let originalTotal = 0;
            let matchedItemsCount = 0;

            lineItems.each(function (index, item) {
              const productId = $(item).attr('data-product-id');
              if (productId) {
                lineItemIds.push(productId);
              }

              const originalPrice = $(item).find('.product__price').find('del').text().replace('$', '');

              if (mdItems.includes(Number(productId))) {
                originalTotal = originalTotal + Number(originalPrice);
                matchedItemsCount++;
              }
            });

            // add HTML table tr to the total lines table body only if all three mdItems are in checkout
            if (matchedItemsCount === mdItems.length) {
              let newTr = `
                <tr class="total-line">
                  <th class="total-line__name" scope="row">Mother's Day Items Total</th>
                  <td class="total-line__price"><span class="order-summary__emphasis skeleton-while-loading">$${Number(originalTotal).toFixed(2)}</span></td>
                </tr>
              `;
              totalLinesTableBody.prepend(newTr);
            }

            // Father's Day info to display
            const reductionLine = $('.total-line--reduction .reduction-code__text');
            const shippingLine = $('.total-line--shipping .total-line__price span');

            if (reductionLine.text() == 'DADWHOLEPACKAGE'){
              shippingLine.text('$0.00');
            }

            if (!alreadyRan) {
              $(".order-summary__section--discount, .section--reductions").append(`<a class="hs-govx" href="https://auth.govx.com/shopify/verify?shop=heartsoil.myshopify.com&utm_source=shopify&utm_medium=govxid&utm_campaign=custom_link" target="_blank"><img src="https://cdn.shopify.com/s/files/1/0317/9898/4835/files/govx.svg?v=1684188643" width="80" height="80" alt="GovX ID"/><span>Military, First Responder and Teacher discount available. Verify with GovX ID to instantly unlock your savings.</span></a>`);
            }

            alreadyRan = true;
          });
        })(Checkout.$);
    </script>
    <script src="https://vglnc.app/load/52097645-931b-4571-8c93-92ffd52faf92"></script>

    {% if checkout.shipping_address.country == 'Canada' or checkout.shipping_address.country == 'Australia' %}
      <style type="text/css">
        .canada-shipping-notice {
           background: #fff5ea;
          border: 1px solid #b98900;
          border-radius: 8px;
          margin-top: 20px;
          margin-bottom: 20px;
          padding: 20px 20px 12px 45px;
          position: relative;
        }

        .canada-shipping-notice h4 {
          color: #000;
          font-size: 16px;
          font-weight: 600;
          margin-bottom: 8px;
        }

        .canada-shipping-notice__icon {
          fill: #b98900;
           position: absolute;
          top: 18px;
          left: 18px;
        }

        .canada-shipping-notice__icon svg {
          height: 20px;
            width: 20px;
        }

        .canada-shipping-notice p {
          color: #000;
          margin-top: 8px;
          margin-bottom: 8px;
        }

        .canada-shipping-notice p.small {
          border-top: 1px solid rgba(0,0,0,0.1);
          font-size: 13px;
          margin-top: 10px;
          padding-top: 10px;
        }
      </style>
    {% endif %}

    {% include 'friendbuy' %}

    {% if checkout.note == 'Discount code: RADICALHEALTH25' %}
      <style>
        /* hide discount code input field */
        .order-summary__section--discount form:nth-of-type(2) {
          display: none!important;
        }
      </style>
    {% endif %}

    {% comment %}
      <!-- Route Code Edited 01/23/2024 -->
      <script type="text/javascript" src="https://cdn.routeapp.io/route-widget-shopify/v2/route-widget-shopify-stable-v2.min.js"></script>
      <style>
        @media (max-width: 912px){
            .order-summary--is-collapsed {
                height: 0px !important;
            }
        }
        .order-summary__sections {
           height: fit-content;
        }
      </style>
      <!-- Route Code End -->
    {% endcomment %}
  </head>
  <body>
    {% comment %}
    {% render 'elevar-checkout-end' %}
    {% endcomment %}
    {{ skip_to_content_link }}

    <header class="banner" data-header role="banner">
      <div class="wrap">
        {{ content_for_logo }}
      </div>
    </header>

    {{ order_summary_toggle }}
    <div class="content" data-content>
      <div class="wrap">
        <div class="main">
          <header class="main__header" role="banner">
            {{ content_for_logo }}
            {{ breadcrumb }}

            {% if checkout.shipping_address.country == 'Canada' %}
              <div class="canada-shipping-notice">
                <div class="canada-shipping-notice__icon">
                  <svg viewBox="0 0 20 20" class="Polaris-Icon__Svg" focusable="false" aria-hidden="true">
                    <path fill-rule="evenodd" d="M10 0C4.486 0 0 4.486 0 10s4.486 10 10 10 10-4.486 10-10S15.514 0 10 0zM9 6a1 1 0 1 1 2 0v4a1 1 0 1 1-2 0V6zm1 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path>
                  </svg>
                </div>
                <h4>SHIPMENTS TO CANADA</h4>
                <p>Please note that all sales to Canada are final.</p>
                <p>
                  Heart & Soil has no affiliation with Canadian customs authorities and cannot be responsible for
                  problems encountered once our products reach the Canadian border. If your order is held up by customs
                  authorities, it is your responsibility to secure the products. Your order may also be subject to
                  Customs Duty fees* upon crossing the border. These fees are the responsibility of the customer alone.
                  No refunds will be issued due to problems at the Canadian border.
                </p>
                <p>Once again, Heart & Soil is not responsible for products once they reach Canada.</p>
                <p class="small">
                  *Customs Duty fees are an import tax levied by (and collected by) the Canadian government on imported
                  goods. Heart & Soil has no involvement with Customs Duty fees.
                </p>
              </div>
            {% endif %}

            {% if checkout.shipping_address.country == 'Australia' %}
              <div class="canada-shipping-notice">
                <div class="canada-shipping-notice__icon">
                  <svg viewBox="0 0 20 20" class="Polaris-Icon__Svg" focusable="false" aria-hidden="true">
                    <path fill-rule="evenodd" d="M10 0C4.486 0 0 4.486 0 10s4.486 10 10 10 10-4.486 10-10S15.514 0 10 0zM9 6a1 1 0 1 1 2 0v4a1 1 0 1 1-2 0V6zm1 9a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"></path>
                  </svg>
                </div>
                <h4>SHIPMENTS TO AUSTRALIA</h4>
                <p>Please note that all sales to Australia are final.</p>
                <p>
                  Heart & Soil has no affiliation with Australian customs authorities and cannot be responsible for
                  problems encountered once our products reach the Australian border. If your order is held up by
                  customs authorities, it is your responsibility to secure the products. Your order may also be subject
                  to Customs Duty fees* upon crossing the border. These fees are the responsibility of the customer
                  alone. No refunds will be issued due to problems at the Australian border.
                </p>
                <p>Once again, Heart & Soil is not responsible for products once they reach Australia.</p>
                <p class="small">
                  *Customs Duty fees are an import tax levied by (and collected by) the Australian government on
                  imported goods. Heart & Soil has no involvement with Customs Duty fees.
                </p>
              </div>
            {% endif %}

            {{ alternative_payment_methods }}
          </header>
          <main class="main__content" role="main">
            {{ content_for_layout }}
          </main>
          <footer class="main__footer" role="contentinfo">
            {{ content_for_footer }}
          </footer>
        </div>
        <aside class="sidebar" role="complementary">
          <div class="sidebar__header">
            {{ content_for_logo }}
          </div>
          <div class="sidebar__content">
            {{ content_for_order_summary }}

            <!-- Route Code Edited 01/23/2024 -->
            {% if content_for_layout contains 'data-step="contact_information"' %}
              <div class="route-div" desktop-align="center"></div>
            {% endif %}
            <!-- Route Code End -->
          </div>
        </aside>
      </div>
    </div>

    <script>
      (function($) {
        $(document).on("page:load page:change", function() {
          const tagListTag = $('.tags-list .tag');

          // cycle through each tagListTag and find the one that equals RADICALHEALTH25 and hide it
          tagListTag.each(function(index, item) {
            const tagReductiontext = $(item).find('.reduction-code__text').text();
            if (tagReductiontext === 'RADICALHEALTH25') {
              $('.product').each(function(index, product) {
                const reductionCodes = $(product).find('.reduction-code');

                // look through each reductionCode and find the one that equals RADICALHEALTH25 (-$0.00) and hide it
                reductionCodes.each(function(index, reductionCode) {
                  const reductionCodeText = $(reductionCode).find('.reduction-code__text').text().trim();

                  if (reductionCodeText === 'RADICALHEALTH25 (-$0.00)') {
                    // hide the reductionCode
                    $(reductionCode).hide();
                  }
                });
              });
            }
          });
        });
      })(Checkout.$);
    </script>

    <script>



        function grabTotal(line, frequency) {
          return line.replace(` every ${frequency} days`,'').replace('$', '');
        }
        setTimeout(() => {
          (function($) {
            var total30 = 0,
                total60 = 0,
                total90 = 0,
                lines = 0;
            $(".total-line--recurring-total-details .recurring-total-detail").each(function() {
              var line = $.trim($(this).find('span').text());
              if(line.includes("30 days")) {
                line = grabTotal(line, 30);
                total30 = total30 + Number(line);
              }
              if(line.includes("60 days")) {
                line = grabTotal(line, 60);
                total60 = total60 + Number(line);
              }
              if(line.includes("90 days")) {
                line = grabTotal(line, 90);
                total90 = total90 + Number(line);
              }
            });

            $(".total-line--recurring-total-details .recurring-total-detail").each(function() {
              var line = $.trim($(this).find('span').text());
              var recurring_text = $(this).find('span');
              if (total30 < 120 && line.includes("30 days") || total60 < 120 && line.includes("60 days") || total90 < 120 && line.includes("90 days")) {
                line = recurring_text.html(`${line},<br />excludes free shipping`);
              }

              var line = $.trim($(this).find('span').text());
              if (total30 >= 120 && line.includes("30 days") || total60 >= 120 && line.includes("60 days") || total90 >= 120 && line.includes("90 days")) {
                line = recurring_text.html(`${line},<br />with free shipping`);
              }
            });
          })(Checkout.$);
        }, 2500);

        // add "Ships separately from supplements" to merch products
        document.addEventListener("DOMContentLoaded", function() {
          const merchIdsToCompare = ['7845481119875'];
          const elementsWithProductId = document.querySelectorAll('[data-product-id]');

          elementsWithProductId.forEach(element => {
            const productId = element.getAttribute('data-product-id');

            if (merchIdsToCompare.includes(productId)) {
              let variantTitle = element.querySelector('.product__description__variant');
              variantTitle.insertAdjacentHTML('afterend', '<span style="color: #994e0e; font-size: 0.8571428571em; font-weight: 600; line-height: 1">Ships separately from supplements</span>');
            }
          });
        });
    </script>

    {{ tracking_code }}

    <script src="{{ 'checkout.js' | asset_url }}"></script>
  </body>
</html>
